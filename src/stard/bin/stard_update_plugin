#!/bin/bash

## Setup Enrivonment
DIR=`dirname $0`
STARD_HOME="$DIR/../"


STANDALONE=%STANDALONE%
if [ $STANDALONE -eq 0 ]; then
	source %SYSCONFDIR%/stard
else
	source "stard/stard-launcher.conf"
	baseDir=`pwd`
	SERVER_DIR="$baseDir/StarMade"
	USER=`id -u`
fi

if [ 'x' == "x$SERVER_DIR" ]; then
	echo "SERVER_DIR undefined. exiting"
	exit 1
fi

if [ 'x' == "x$baseDir" ]; then
	echo "baseDir undefined. exiting"
	exit 1
fi
while [ "x" != "x$1" ]; do
	NEW_PLUGIN="$1"
	shift

	NEW_PLUGIN_BASENAME=`basename $NEW_PLUGIN`
	ACTIVE_PLUGIN_DIR="$STARD_HOME/plugins"
	INACTIVE_PLUGIN_DIR="$STARD_HOME/plugins.disabled"
	
	mkdir -p "$ACTIVE_PLUGIN_DIR"
	mkdir -p "$INACTIVE_PLUGIN_DIR"

	if [ -d "$ACTIVE_PLUGIN_DIR/$NEW_PLUGIN_BASENAME" ]; then
		rsync -arv --delete \
			--exclude '*.conf' \
			--exclude '*.ini' \
			--exclude '*.cnf' \
			--exclude '*.cfg' \
			"$NEW_PLUGIN/" \
			"$ACTIVE_PLUGIN_DIR/$NEW_PLUGIN_BASENAME/"
		rsync -arv --delete \
			--ignore-existing \
			"$NEW_PLUGIN/" \
			"$ACTIVE_PLUGIN_DIR/$NEW_PLUGIN_BASENAME/"
	elif [ -d "$INACTIVE_PLUGIN_DIR/$NEW_PLUGIN_BASENAME" ]; then
		rsync -arv --delete \
			--exclude '*.conf' \
			--exclude '*.ini' \
			--exclude '*.cnf' \
			--exclude '*.cfg' \
			"$NEW_PLUGIN/" \
			"$INACTIVE_PLUGIN_DIR/$NEW_PLUGIN_BASENAME/"
		rsync -arv --delete \
			--ignore-existing \
			"$NEW_PLUGIN/" \
			"$INACTIVE_PLUGIN_DIR/$NEW_PLUGIN_BASENAME/"
	
	else
		rsync -arv
			"$NEW_PLUGIN/" \
			"$INACTIVE_PLUGIN_DIR/$NEW_PLUGIN_BASENAME/"
	fi
done
