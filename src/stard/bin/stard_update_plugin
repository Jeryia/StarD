#!/bin/bash

## Setup Enrivonment
DIR=`dirname $0`
STARD_HOME="$DIR/../"


STANDALONE=%STANDALONE%
if [ $STANDALONE -eq 0 ]; then
	source %SYSCONFDIR%/stard
else
	source "stard/stard-launcher.conf"
	baseDir=`pwd`
	SERVER_DIR="$baseDir/StarMade"
	USER=`id -u`
fi

if [ 'x' == "x$SERVER_DIR" ]; then
	echo "SERVER_DIR undefined. exiting"
	exit 1
fi

if [ 'x' == "x$baseDir" ]; then
	echo "baseDir undefined. exiting"
	exit 1
fi
while [ "x" != "x$1" ]; do
	NEW_PLUGIN="$1"
	shift

	NEW_PLUGIN_BASENAME=`basename $NEW_PLUGIN`
	PLUGIN_DIR="$STARD_HOME/plugins"
	
	mkdir -p "$PLUGIN_DIR"

	rsync -arv --delete \
		--exclude '*.conf' \
		--exclude '*.ini' \
		--exclude '*.cnf' \
		--exclude '*.cfg' \
		"$NEW_PLUGIN/" \
		"$PLUGIN_DIR/$NEW_PLUGIN_BASENAME/"
	rsync -arv --delete \
		--ignore-existing \
		"$NEW_PLUGIN/" \
		"$PLUGIN_DIR/$NEW_PLUGIN_BASENAME/"
done
